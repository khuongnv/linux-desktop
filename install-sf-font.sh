#!/bin/bash
# Script cÃ i Ä‘áº·t SF Pro Font vÃ  Ä‘áº·t lÃ m font há»‡ thá»‘ng máº·c Ä‘á»‹nh

set -e

FONT_SOURCE="/home/khuongnv/Downloads/SF-Font"
FONT_DEST="$HOME/.local/share/fonts/SF-Pro"

echo "=========================================="
echo "  CÃ€I Äáº¶T SF PRO FONT CHO Há»† THá»NG"
echo "=========================================="
echo ""

# Kiá»ƒm tra thÆ° má»¥c nguá»“n
if [ ! -d "$FONT_SOURCE" ]; then
    echo "âŒ KhÃ´ng tÃ¬m tháº¥y thÆ° má»¥c font: $FONT_SOURCE"
    exit 1
fi

# Äáº¿m sá»‘ file font
FONT_COUNT=$(find "$FONT_SOURCE" -type f \( -name "*.ttf" -o -name "*.otf" -o -name "*.ttc" \) | wc -l)
echo "ğŸ“¦ TÃ¬m tháº¥y $FONT_COUNT file font trong $FONT_SOURCE"
echo ""

# Táº¡o thÆ° má»¥c Ä‘Ã­ch
echo "ğŸ“ Táº¡o thÆ° má»¥c font: $FONT_DEST"
mkdir -p "$FONT_DEST"

# Copy font
echo "ğŸ“‹ Äang copy font..."
cp -r "$FONT_SOURCE"/* "$FONT_DEST"/
echo "âœ… ÄÃ£ copy $FONT_COUNT file font"
echo ""

# Cáº­p nháº­t font cache
echo "ğŸ”„ Äang cáº­p nháº­t font cache..."
fc-cache -fv "$FONT_DEST" 2>&1 | grep -i "cache\|font" | head -5
echo "âœ… Font cache Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t"
echo ""

# Kiá»ƒm tra font Ä‘Ã£ Ä‘Æ°á»£c cÃ i Ä‘áº·t
echo "ğŸ” Kiá»ƒm tra font Ä‘Ã£ Ä‘Æ°á»£c cÃ i Ä‘áº·t:"
fc-list | grep -i "SF Pro\|San Francisco" | head -3
echo ""

# Láº¥y tÃªn font chÃ­nh xÃ¡c tá»« font cache
FONT_NAME=$(fc-list | grep -i "SF Pro" | grep -i "Regular\|Text Regular" | head -1 | cut -d: -f2 | awk '{print $1}' | tr -d ',')

if [ -z "$FONT_NAME" ]; then
    # Thá»­ tÃ¬m vá»›i tÃªn khÃ¡c
    FONT_NAME=$(fc-list | grep -i "SF Pro" | head -1 | cut -d: -f2 | awk '{print $1}' | tr -d ',')
fi

if [ -z "$FONT_NAME" ]; then
    echo "âš ï¸  KhÃ´ng tÃ¬m tháº¥y tÃªn font chÃ­nh xÃ¡c, sáº½ dÃ¹ng 'SF Pro'"
    FONT_NAME="SF Pro"
else
    echo "âœ… TÃ¬m tháº¥y font: $FONT_NAME"
fi
echo ""

# Hiá»ƒn thá»‹ font hiá»‡n táº¡i
CURRENT_FONT=$(gsettings get org.gnome.desktop.interface font-name | tr -d "'")
echo "ğŸ“ Font hiá»‡n táº¡i: $CURRENT_FONT"
echo ""

# Äáº·t font máº·c Ä‘á»‹nh
echo "âš™ï¸  Äang Ä‘áº·t font há»‡ thá»‘ng..."

# Font máº·c Ä‘á»‹nh (UI)
if [ ! -z "$FONT_NAME" ]; then
    # Thá»­ vá»›i tÃªn Ä‘áº§y Ä‘á»§
    gsettings set org.gnome.desktop.interface font-name "$FONT_NAME 11" 2>/dev/null || \
    gsettings set org.gnome.desktop.interface font-name "SF Pro Text 11" 2>/dev/null || \
    gsettings set org.gnome.desktop.interface font-name "SF Pro Display 11" 2>/dev/null || \
    echo "âš ï¸  KhÃ´ng thá»ƒ Ä‘áº·t font vá»›i tÃªn tá»± Ä‘á»™ng, vui lÃ²ng chá»n thá»§ cÃ´ng"
    
    echo "âœ… ÄÃ£ Ä‘áº·t font máº·c Ä‘á»‹nh"
fi

# Font monospace (terminal, code editor) â€” cá»¡ 12 cho dá»… Ä‘á»c
gsettings set org.gnome.desktop.interface monospace-font-name "SF Mono 12" 2>/dev/null || \
gsettings set org.gnome.desktop.interface monospace-font-name "SF Pro Text 12" 2>/dev/null || \
echo "âš ï¸  KhÃ´ng tÃ¬m tháº¥y SF Mono/SF Pro Text, giá»¯ nguyÃªn font monospace hiá»‡n táº¡i"

# Font document
gsettings set org.gnome.desktop.interface document-font-name "$FONT_NAME 11" 2>/dev/null || \
gsettings set org.gnome.desktop.interface document-font-name "SF Pro Text 11" 2>/dev/null || \
echo "âš ï¸  KhÃ´ng thá»ƒ Ä‘áº·t document font"

# Font window title
gsettings set org.gnome.desktop.wm.preferences titlebar-font "$FONT_NAME Bold 11" 2>/dev/null || \
gsettings set org.gnome.desktop.wm.preferences titlebar-font "SF Pro Display Bold 11" 2>/dev/null || \
echo "âš ï¸  KhÃ´ng thá»ƒ Ä‘áº·t titlebar font"

echo ""
echo "=========================================="
echo "âœ… HOÃ€N Táº¤T!"
echo "=========================================="
echo ""
echo "ğŸ“Œ Font Ä‘Ã£ Ä‘Æ°á»£c cÃ i Ä‘áº·t táº¡i: $FONT_DEST"
echo "ğŸ“Œ Font Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº·t lÃ m máº·c Ä‘á»‹nh cho há»‡ thá»‘ng"
echo ""
echo "ğŸ’¡ LÆ°u Ã½:"
echo "   - Báº¡n cÃ³ thá»ƒ cáº§n Ä‘Äƒng xuáº¥t vÃ  Ä‘Äƒng nháº­p láº¡i Ä‘á»ƒ Ã¡p dá»¥ng Ä‘áº§y Ä‘á»§"
echo "   - Hoáº·c khá»Ÿi Ä‘á»™ng láº¡i cÃ¡c á»©ng dá»¥ng Ä‘ang cháº¡y"
echo ""
echo "ğŸ”§ Äá»ƒ kiá»ƒm tra/Ä‘á»•i font thá»§ cÃ´ng:"
echo "   - Má»Ÿ Settings > Appearance > Fonts"
echo "   - Hoáº·c cháº¡y: gnome-tweaks"
echo ""
echo "ğŸ“‹ Äá»ƒ xem danh sÃ¡ch font SF Pro Ä‘Ã£ cÃ i:"
echo "   fc-list | grep -i 'SF Pro'"
echo ""
